-- ╔═══════════════════════════════════════════════════════════╗
-- ║            BRAINROT SCANNER + SMART SERVER HOP            ║
-- ║                Version: 2.0 (Robuste & Persistante)       ║
-- ╚═══════════════════════════════════════════════════════════╝

local Workspace = game:GetService("Workspace")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- ============================= CONFIG =============================
local DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1433201186541928691/TIBPT4rx_ktXunxR8xXoSCJFMNwmOQ_a7Fke3PEeUUUj-VILhriRZvGMb5KfxORU9qsB"
local REPLIT_SERVER = "https://cbb52fb2-f3e0-4691-a5e1-295c6cf29958-00-3ewo9jh2rrnsb.janeway.replit.dev:3000"
local PLACE_ID = 109983668079237

local MaxServerHistory = 15
local FastHop = false
local AggressiveHopping = false
local MaxTimeInServer = 120
local MinScanBeforeHop = 1

-- Persistance
local VISITED_KEY = "BrainrotScanner_VisitedServers_v2"
local visitedServers = {}
local scanCount = 0
local found, totalFound = {}, 0

-- ============================= HTTP SETUP =============================
local function getHttpFunction()
	return (syn and syn.request)
		or (http and http.request)
		or (http_request)
		or (request)
		or (fluxus and fluxus.request)
		or nil
end

local httpRequest = getHttpFunction()
if not httpRequest then
	warn("Aucune fonction HTTP compatible trouvée.")
end

-- ============================= PERSISTENCE =============================
local function loadVisited()
	pcall(function()
		if readfile and isfile and isfile(VISITED_KEY) then
			local data = readfile(VISITED_KEY)
			local decoded = HttpService:JSONDecode(data)
			if typeof(decoded) == "table" then
				visitedServers = decoded
				print("Chargé " .. #visitedServers .. " serveurs visités.")
			end
		end
	end)
end

local function saveVisited()
	pcall(function()
		if writefile then
			writefile(VISITED_KEY, HttpService:JSONEncode(visitedServers))
		end
	end)
end

loadVisited()

-- ============================= BRAINROTS LIST =============================
local BRAINROTS = {
    "Noobini Pizzanini","Lirilì Larilà","Tim Cheese","Fluriflura","Talpa Di Fero","Svinina Bombardino","Pipi Kiwi",
    "Trippi Troppi","Gangster Footera","Bandito Bobritto","Boneca Ambalabu","Cacto Hipopotamo","Ta Ta Ta Ta Sahur",
    "Tric Trac Baraboom","Cappuccino Assassino","Brr Brr Patapim","Avocadini Antilopini","Trulimero Trulicina",
    "Bambini Crostini","Bananita Dolphinita","Perochello Lemonchello","Brri Brri Bicus Dicus Bombicus",
    "Avocadini Guffo","Salamino Penguino","Burbaloni Loliloli","Chimpanzini Bananini","Ballerina Cappuccina",
    "Chef Crabracadabra","Lionel Cactuseli","Glorbo Fruttodrillo","Quivioli Ameleonni","Blueberrinni Octopusini",
    "Pipi Potato","Strawberrelli Flamingelli","Pandaccini Bananini","Sigma Boy","Frigo Camelo","Orangutini Ananassini",
    "Rhino Toasterino","Bombardiro Crocodilo","Bombombini Gusini","Cavallo Virtuoso","Gorillo Watermelondrillo",
    "Cachorrito Melonito","Lerulerulerule","Te Te Te Sahur","Tracoducotulu Delapeladustuz","Toiletto Focaccino",
    "Jacko Spaventosa","Cocofanto Elefanto","Girafa Celestre","Tralalero Tralala","Tigroligre Frutonni",
    "Odin Din Din Dun","Orcalero Orcala","Tralalita Tralala","Trenostruzzo Turbo 3000","Trippi Troppi Troppa Trippa",
    "Ballerino Lololo","Bulbito Bandito Traktorito","Pakrahmatmamat","Piccione Macchina","Tractoro Dinosauro",
    "Los Orcalitos","Cacasito Satalito","Tartaruga Cisterna","Mastodontico Telepiedone","Snailenzo","Tentacolo Tecnico",
    "Bisonte Giuppitere","La Vacca Saturno Saturnita","Torrtuginni Dragonfrutini","Los Tralaleritos","Los Spyderinis",
    "Las Tralaleritas","Job Job Job Sahur","Las Vaquitas Saturnitas","Graipuss Medussi","To to to Sahur","Pot Hotspot",
    "Chicleteira Bicicleteira","Los Chicleteiras","La Grande Combinasion","Nuclearo Dinossauro","Esok Sekolah",
    "Money Money Puggy","Ketupat Kepat","Tictac Sahur","Ketchuru and Musturu","Garama and Madundung",
    "Spaghetti Tualetti","La Secret Combinasion","Burguro And Fryuro","Dragon Cannelloni","Strawberry Elephant",
    "Meowl","Carloo","Alessio","Los Bombinitos","Crabbo Limonetta","Blackhole Goat","Guerriro Digitale",
    "Raccooni Jandelini","Gattatino Nyanino","Matteo","Espresso Signora","Unclito Samito","Extinct Ballerina",
    "Urubini Flamenguini","Brasilini Berimbini","Corn Corn Corn Sahur","Karkerkar Kurkur","Sammyni Spyderini",
    "Dul Dul Dul","Chachechi","Extinct Tralalero","La Cucaracha","Extinct Matteo","Mariachi Corazoni",
    "Tacorita Bicicleta","La Extinct Grande","Bambu Bambu Sahur","Chihuanini Taconini","Tipi Topi Taco",
    "Capi Taco","Gattito Tacoto","Bombardini Tortini","Los Tipi Tacos","Nooo My Hotspot","Quesadilla Crocodila",
    "Burrito Bandito","Perrito Burrito","Chillin Chili","Chipso and Queso","La Taco Combinasion","Bandito Axolito",
    "Malame Amarele","Mangolini Parrocini","Tirilikalika Tirilikalako","Caramello Filtrello","Signore Carapace",
    "Sigma Girl","Bruto Gialutto","Gorillo Subwoofero","Rhino Helicopterino","Los Noobinis","Elefanto Frigo",
    "Antonio","Las Cappuchinas","Orcalita Orcala","Dug dug dug","Piccionetta Machina","Anpali Babel","Belula Beluga",
    "Trenostruzzo Turbo 4000","Fragola La La La","La Karkerkar Combinasion","La Sahur Combinasion","Las Sis",
    "Celularcini Viciosini","Los Bros","Tralaledon","Los Tacoritas","Los Primos","Horegini Boom","Vampira Cappucina",
    "Zombie Tralala","Frankentteo","La Vacca Jacko Linterino","La Spooky Grande","Pipi Corni","Pipi Avocado",
    "Ti Ti Ti Sahur","Penguino Cocosino","Cocosini Mama","Pi Pi Watermelon","Avocadorilla","Tob Tobi Tobi",
    "Ganganzelli Trulala","Tukanno Bananno","Los Tungtungtungcitos","Brr es Teh Patipum","Agarrini La Palini",
    "Los Combinasionas","Los Hotspotsitos","La Supreme Combinasion","Los Crocodillitos","Los Orcalitos",
    "Los Matteos","Los Spyderinis","Las Vaquitas Saturnitas","Los Karkeritos","Los Chicleteiras","Kings Coleslaw",
    "Developorini Braziliaspidini","Chimpanzini Spiderini","Statutino Libertino","Gattatino Neonino",
    "Tung Tung Tung Sahur","Tartaragno","Pinealotto Fruttarino","Frogato Pirato","Eviledon","Mummio Rappitto",
    "Buho De Fuego","Magi Ribbitini","Vulturino Skeletono","Spooky and Pumpky","Mieteteira Bicicleteira",
    "Jacko Jack Jack","Quackula","Headless Horseman","La Grande Combinasion"
}

-- ============================= UTILS =============================
local function extractMoney(text)
	if not text then return 0 end
	local lower = text:lower()
	if not (lower:find("/s") or lower:find("per second") or lower:find("sec")) then
		return 0
	end
	local cleaned = lower:gsub(",", ""):gsub("%s", "")
	local number, suffix = cleaned:match("(%d+%.?%d*)([kmb]?)")
	local value = tonumber(number)
	if not value then return 0 end
	if suffix == "k" then value *= 1000
	elseif suffix == "m" then value *= 1000000
	elseif suffix == "b" then value *= 1000000000 end
	return math.floor(value)
end

local function sendToServer(name, money)
	if found[name] then return end
	found[name] = true
	totalFound += 1
	local jobId = game.JobId
	local players = #Players:GetPlayers() .. "/" .. Players.MaxPlayers

	if httpRequest then
		pcall(function()
			httpRequest({
				Url = REPLIT_SERVER .. "/api/server",
				Method = "POST",
				Headers = {
					["Content-Type"] = "application/json",
					["User-Agent"] = "Roblox/BrainrotScanner"
				},
				Body = HttpService:JSONEncode({
					name = name,
					job_id = jobId,
					money_per_sec = money,
					players = players,
					timestamp = os.time()
				})
			})
		end)
		print("Envoyé : " .. name .. " | " .. money .. "/sec | " .. players)
	else
		print("Impossible d'envoyer : " .. name .. " (" .. money .. "/sec)")
	end
end

-- ============================= SCAN =============================
local function scanBrainrots()
	scanCount += 1
	print("Scan #" .. scanCount .. " en cours...")

	for _, obj in pairs(Workspace:GetDescendants()) do
		if obj:IsA("TextLabel") or obj:IsA("TextBox") or obj:IsA("TextButton") then
			local text = obj.Text
			if text and text ~= "" then
				for _, name in pairs(BRAINROTS) do
					if string.find(string.lower(text), string.lower(name), 1, true) then
						local parent = obj.Parent
						if parent then
							for _, sibling in pairs(parent:GetChildren()) do
								if sibling:IsA("TextLabel") or sibling:IsA("TextBox") or sibling:IsA("TextButton") then
									local money = extractMoney(sibling.Text)
									if money >= 10000 then
										sendToServer(name, money)
									end
								end
							end
						end
					end
				end
			end
		end
	end
	print("Scan terminé. Trouvé : " .. totalFound)
end

-- ============================= SMART SERVER HOP =============================
local function serverHop(force)
	if not force and scanCount < MinScanBeforeHop then
		print("Trop tôt pour hop (scans: " .. scanCount .. "/" .. MinScanBeforeHop .. ")")
		return
	end

	local currentJobId = game.JobId
	table.insert(visitedServers, currentJobId)
	if #visitedServers > MaxServerHistory then
		table.remove(visitedServers, 1)
	end
	saveVisited()

	local servers = {}
	local cursor = ""

	-- Récupérer tous les serveurs valides
	repeat
		local url = "https://games.roblox.com/v1/games/" .. PLACE_ID .. "/servers/Public?sortOrder=Asc&limit=100"
		if cursor ~= "" then url = url .. "&cursor=" .. cursor end

		local success, response = pcall(function()
			return game:HttpGet(url, true)
		end)

		if not success then break end
		local data = HttpService:JSONDecode(response)
		if not data or not data.data then break end

		for _, srv in pairs(data.data) do
			if srv.playing > 0 and srv.playing < srv.maxPlayers
			and srv.id ~= currentJobId
			and not table.find(visitedServers, srv.id) then
				table.insert(servers, srv.id)
			end
		end
		cursor = data.nextPageCursor or ""
		task.wait(0.1)
	until cursor == ""

	if #servers == 0 then
		print("Aucun serveur valide. Téléportation aléatoire...")
		TeleportService:Teleport(PLACE_ID, Players.LocalPlayer)
		return
	end

	-- Mélanger
	for i = #servers, 2, -1 do
		local j = math.random(i)
		servers[i], servers[j] = servers[j], servers[i]
	end

	local localPlayer = Players.LocalPlayer
	local connection

	connection = TeleportService.TeleportInitFailed:Connect(function(player, result, msg)
		if player ~= localPlayer then return end
		connection:Disconnect()
		print("Échec téléportation : " .. tostring(result) .. " | " .. msg)
		task.wait(1 + math.random())
		tryNext()
	end)

	local index = 1
	local function tryNext()
		if index > #servers then
			print("Plus de serveurs. Téléportation aléatoire.")
			TeleportService:Teleport(PLACE_ID, localPlayer)
			return
		end

		local serverId = servers[index]
		index += 1
		print("Hop → " .. serverId .. " (" .. index-1 .. "/" .. #servers .. ")")
		task.wait(0.5 + math.random() * 0.5)
		TeleportService:TeleportToPlaceInstance(PLACE_ID, serverId, localPlayer)
	end

	tryNext()
end

-- ============================= AUTO HOP TIMER =============================
task.spawn(function()
	task.wait(MaxTimeInServer + math.random(-10, 10))
	print("Temps max atteint → Hop forcé !")
	serverHop(true)
end)

-- ============================= MAIN LOOP =============================
task.spawn(function()
	task.wait(5 + math.random(0, 3))
	scanBrainrots()

	task.wait(2)

	if FastHop or AggressiveHopping then
		serverHop(true)
	else
		serverHop()
	end
end)

-- Sauvegarde à la sortie
game:BindToClose(function()
	saveVisited()
end)

print("Scanner Brainrot v2.0 lancé avec persistance et retry intelligent.")
